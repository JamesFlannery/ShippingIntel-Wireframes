<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Discovery Analytics Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="behavioral-visualizer.js"></script>
    <style>
        .analytics-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0a0a;
            color: #ffffff;
            min-height: 100vh;
            overflow-y: auto;
        }
        
        body {
            margin: 0;
            padding: 0;
            background: #0a0a0a;
            overflow-x: hidden;
        }
        
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 8px;
        }
        
        .dashboard-header h1 {
            color: #ffffff;
            margin: 0 0 10px 0;
        }
        
        .dashboard-header p {
            color: #cccccc;
            margin: 0;
        }
        
        .dashboard-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .control-btn:hover {
            background: #444;
        }
        
        .control-btn.active {
            background: #0066cc;
        }
        
        .analytics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .analytics-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #333;
        }
        
        .analytics-card h3 {
            color: #ffffff;
            margin: 0 0 15px 0;
            font-size: 18px;
        }
        
        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #333;
        }
        
        .metric-row:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #cccccc;
            font-size: 14px;
        }
        
        .metric-value {
            color: #ffffff;
            font-weight: bold;
            font-size: 16px;
        }
        
        .metric-value.positive {
            color: #00cc66;
        }
        
        .metric-value.negative {
            color: #ff6666;
        }
        
        .metric-value.warning {
            color: #ffaa00;
        }
        
        .event-list {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #333;
            margin-bottom: 20px;
        }
        
        .event-item {
            padding: 10px 0;
            border-bottom: 1px solid #333;
            font-size: 13px;
        }
        
        .event-item:last-child {
            border-bottom: none;
        }
        
        .event-timestamp {
            color: #888;
            font-size: 11px;
        }
        
        .event-type {
            color: #0066cc;
            font-weight: bold;
            margin: 0 10px;
        }
        
        .event-details {
            color: #cccccc;
            margin-top: 5px;
        }
        
        .intent-signal {
            background: #2a3a0a;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            color: #88ff88;
        }
        
        .friction-signal {
            background: #3a1a0a;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 11px;
            color: #ff8888;
        }
        
        .session-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #333;
        }
        
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .session-id {
            font-family: monospace;
            font-size: 12px;
            color: #888;
        }
        
        .session-duration {
            color: #0066cc;
            font-size: 12px;
        }
        
        .session-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            font-size: 12px;
        }
        
        .session-stat {
            text-align: center;
        }
        
        .session-stat-value {
            display: block;
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
        }
        
        .session-stat-label {
            color: #888;
        }
        
        .no-data {
            text-align: center;
            color: #888;
            font-style: italic;
            padding: 40px;
        }
        
        /* Visualization Styles */
        .visualization-container {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
            position: relative;
        }
        
        .visualization-container h3 {
            color: #ffffff;
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        
        .domain-insights {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #333;
        }
        
        .insight-section {
            margin-bottom: 20px;
        }
        
        .insight-section h4 {
            color: #ffffff;
            margin: 0 0 10px 0;
            font-size: 14px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }
        
        .insight-item {
            background: #2a2a2a;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            border-left: 3px solid #0066cc;
        }
        
        .insight-pattern {
            color: #ffffff;
            font-weight: bold;
            font-size: 13px;
        }
        
        .insight-implication {
            color: #cccccc;
            font-size: 12px;
            margin: 5px 0;
        }
        
        .insight-opportunity {
            color: #88ff88;
            font-size: 12px;
            font-weight: bold;
        }
        
        .user-segments {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .segment-card {
            background: #2a2a2a;
            border-radius: 6px;
            padding: 15px;
            border: 1px solid #444;
        }
        
        .segment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .segment-header h4 {
            color: #ffffff;
            margin: 0;
            font-size: 14px;
        }
        
        .segment-count {
            background: #0066cc;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .segment-concerns, .segment-decisions {
            color: #cccccc;
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .segment-needs ul {
            margin: 5px 0 0 15px;
            color: #aaaaaa;
            font-size: 11px;
        }
        
        .product-opportunities {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 15px;
        }
        
        .opportunity-card {
            background: #2a4a2a;
            border-radius: 6px;
            padding: 15px;
            border: 1px solid #446644;
        }
        
        .opportunity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .opportunity-header h4 {
            color: #88ff88;
            margin: 0;
            font-size: 14px;
        }
        
        .opportunity-priority {
            background: #ff6600;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
        }
        
        .opportunity-description {
            color: #cccccc;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .opportunity-details {
            font-size: 11px;
            color: #aaaaaa;
        }
        
        .opportunity-details div {
            margin-bottom: 3px;
        }
        
        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .session-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="analytics-container">
        <div class="dashboard-header">
            <h1>üîç Product Discovery Analytics</h1>
            <p>Behavioral insights from Maritime Intelligence platform usage</p>
        </div>
        
        <div class="dashboard-controls">
            <button class="control-btn active" onclick="showView('overview')">Overview</button>
            <button class="control-btn" onclick="showView('visualizations')">üìä Visualizations</button>
            <button class="control-btn" onclick="showView('domain-insights')">üß† Domain Insights</button>
            <button class="control-btn" onclick="showView('events')">Event Stream</button>
            <button class="control-btn" onclick="showView('sessions')">Sessions</button>
            <button class="control-btn" onclick="showView('intents')">Intent Signals</button>
            <button class="control-btn" onclick="showView('friction')">Friction Points</button>
            <button class="control-btn" onclick="refreshData()">üîÑ Refresh</button>
            <button class="control-btn" onclick="clearData()">üóëÔ∏è Clear Data</button>
        </div>
        
        <!-- Overview Dashboard -->
        <div id="overview-view">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>üìä Usage Overview</h3>
                    <div class="metric-row">
                        <span class="metric-label">Total Sessions</span>
                        <span class="metric-value" id="total-sessions">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Total Events</span>
                        <span class="metric-value" id="total-events">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Avg Session Duration</span>
                        <span class="metric-value" id="avg-duration">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Active Users</span>
                        <span class="metric-value" id="active-users">-</span>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>üéØ Intent Signals</h3>
                    <div class="metric-row">
                        <span class="metric-label">Calculation Attempts</span>
                        <span class="metric-value positive" id="calculation-intents">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Export Attempts</span>
                        <span class="metric-value positive" id="export-intents">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Comparison Patterns</span>
                        <span class="metric-value positive" id="comparison-intents">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Data Extraction</span>
                        <span class="metric-value positive" id="extraction-intents">-</span>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>‚ö†Ô∏è Friction Points</h3>
                    <div class="metric-row">
                        <span class="metric-label">Failed Interactions</span>
                        <span class="metric-value negative" id="failed-interactions">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Analysis Paralysis</span>
                        <span class="metric-value warning" id="analysis-paralysis">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Navigation Confusion</span>
                        <span class="metric-value negative" id="navigation-confusion">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">High Dwell Time</span>
                        <span class="metric-value warning" id="high-dwell">-</span>
                    </div>
                </div>
                
                <div class="analytics-card">
                    <h3>üì± Popular Views</h3>
                    <div class="metric-row">
                        <span class="metric-label">Data View</span>
                        <span class="metric-value" id="data-view-count">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Overview</span>
                        <span class="metric-value" id="overview-count">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Geography</span>
                        <span class="metric-value" id="geography-count">-</span>
                    </div>
                    <div class="metric-row">
                        <span class="metric-label">Timeline</span>
                        <span class="metric-value" id="timeline-count">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Event Stream View -->
        <div id="events-view" style="display: none;">
            <div class="event-list">
                <h3>üìã Recent Events</h3>
                <div id="events-container">
                    <div class="no-data">No events recorded yet. Start using the Maritime Intelligence platform to see behavioral data.</div>
                </div>
            </div>
        </div>
        
        <!-- Sessions View -->
        <div id="sessions-view" style="display: none;">
            <div class="event-list">
                <h3>üë• User Sessions</h3>
                <div id="sessions-container">
                    <div class="no-data">No sessions recorded yet.</div>
                </div>
            </div>
        </div>
        
        <!-- Intent Signals View -->
        <div id="intents-view" style="display: none;">
            <div class="event-list">
                <h3>üéØ Intent Signals Detected</h3>
                <div id="intents-container">
                    <div class="no-data">No intent signals detected yet.</div>
                </div>
            </div>
        </div>
        
        <!-- Friction Points View -->
        <div id="friction-view" style="display: none;">
            <div class="event-list">
                <h3>‚ö†Ô∏è Friction Points Detected</h3>
                <div id="friction-container">
                    <div class="no-data">No friction points detected yet.</div>
                </div>
            </div>
        </div>
        
        <!-- Visualizations View -->
        <div id="visualizations-view" style="display: none;">
            <div class="visualization-container">
                <h3>üõ§Ô∏è User Journey Flow</h3>
                <div id="journey-flow-container">
                    <div class="no-data">Loading journey visualization...</div>
                </div>
            </div>
            
            <div class="visualization-container">
                <h3>üìà Intent Patterns Timeline</h3>
                <div id="intent-timeline-container">
                    <div class="no-data">Loading intent timeline...</div>
                </div>
            </div>
            
            <div class="visualization-container">
                <h3>üéØ Behavioral Heatmap</h3>
                <div id="heatmap-container" style="height: 400px; position: relative;">
                    <div class="no-data">Heatmap visualization shows click patterns across the interface</div>
                </div>
            </div>
        </div>
        
        <!-- Domain Insights View -->
        <div id="domain-insights-view" style="display: none;">
            <div class="domain-insights">
                <h3>üö¢ Maritime Domain Analysis</h3>
                <div id="domain-analysis-container">
                    <div class="no-data">Loading domain insights...</div>
                </div>
            </div>
            
            <div class="domain-insights">
                <h3>üë• User Segment Profiles</h3>
                <div id="user-segments-container">
                    <div class="no-data">Loading user segment analysis...</div>
                </div>
            </div>
            
            <div class="domain-insights">
                <h3>üí° Product Opportunities</h3>
                <div id="product-opportunities-container">
                    <div class="no-data">Loading product opportunities...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentView = 'overview';
        let analyticsData = {
            events: [],
            sessions: {},
            intents: [],
            friction: []
        };
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            loadAnalyticsData();
            updateDashboard();
            
            // Initialize visualizer
            window.behavioralVisualizer = new BehavioralVisualizer();
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadAnalyticsData();
                updateDashboard();
            }, 30000);
        });
        
        function loadAnalyticsData() {
            try {
                const storedEvents = JSON.parse(localStorage.getItem('pd_events') || '[]');
                analyticsData.events = storedEvents;
                
                // Process events into categories
                analyticsData.intents = storedEvents.filter(e => e.eventType === 'intent_signal');
                analyticsData.friction = storedEvents.filter(e => e.eventType === 'friction_detected');
                
                // Group by session
                analyticsData.sessions = {};
                storedEvents.forEach(event => {
                    if (!analyticsData.sessions[event.sessionId]) {
                        analyticsData.sessions[event.sessionId] = {
                            sessionId: event.sessionId,
                            userId: event.userId,
                            startTime: event.timestamp,
                            endTime: event.timestamp,
                            events: [],
                            views: new Set(),
                            interactions: 0,
                            intents: 0,
                            friction: 0
                        };
                    }
                    
                    const session = analyticsData.sessions[event.sessionId];
                    session.events.push(event);
                    session.endTime = event.timestamp;
                    
                    if (event.currentView) {
                        session.views.add(event.currentView);
                    }
                    
                    if (event.eventType === 'interaction') session.interactions++;
                    if (event.eventType === 'intent_signal') session.intents++;
                    if (event.eventType === 'friction_detected') session.friction++;
                });
                
            } catch (error) {
                console.error('Error loading analytics data:', error);
            }
        }
        
        function updateDashboard() {
            updateOverviewMetrics();
            
            if (currentView === 'events') updateEventsView();
            if (currentView === 'sessions') updateSessionsView();
            if (currentView === 'intents') updateIntentsView();
            if (currentView === 'friction') updateFrictionView();
            if (currentView === 'visualizations') updateVisualizationsView();
            if (currentView === 'domain-insights') updateDomainInsightsView();
        }
        
        function updateOverviewMetrics() {
            const sessions = Object.values(analyticsData.sessions);
            const events = analyticsData.events;
            const intents = analyticsData.intents;
            const friction = analyticsData.friction;
            
            // Basic metrics
            document.getElementById('total-sessions').textContent = sessions.length;
            document.getElementById('total-events').textContent = events.length;
            document.getElementById('active-users').textContent = new Set(sessions.map(s => s.userId)).size;
            
            // Average session duration
            if (sessions.length > 0) {
                const avgDuration = sessions.reduce((acc, session) => {
                    const start = new Date(session.startTime);
                    const end = new Date(session.endTime);
                    return acc + (end - start);
                }, 0) / sessions.length;
                
                document.getElementById('avg-duration').textContent = formatDuration(avgDuration);
            }
            
            // Intent signals
            document.getElementById('calculation-intents').textContent = intents.filter(i => 
                i.eventData.intentType?.includes('calculation')).length;
            document.getElementById('export-intents').textContent = intents.filter(i => 
                i.eventData.intentType?.includes('export')).length;
            document.getElementById('comparison-intents').textContent = intents.filter(i => 
                i.eventData.intentType?.includes('comparison')).length;
            document.getElementById('extraction-intents').textContent = intents.filter(i => 
                i.eventData.intentType?.includes('extraction')).length;
            
            // Friction points
            document.getElementById('failed-interactions').textContent = friction.filter(f => 
                f.eventData.frictionType === 'failed_interaction').length;
            document.getElementById('analysis-paralysis').textContent = friction.filter(f => 
                f.eventData.frictionType === 'analysis_paralysis').length;
            document.getElementById('navigation-confusion').textContent = friction.filter(f => 
                f.eventData.frictionType === 'user_confusion').length;
            document.getElementById('high-dwell').textContent = events.filter(e => 
                e.eventType === 'dwell_pattern' && e.eventData.dwellDuration > 60000).length;
            
            // Popular views
            const viewCounts = {};
            events.forEach(event => {
                if (event.currentView) {
                    viewCounts[event.currentView] = (viewCounts[event.currentView] || 0) + 1;
                }
            });
            
            document.getElementById('data-view-count').textContent = viewCounts['data'] || 0;
            document.getElementById('overview-count').textContent = viewCounts['index'] || 0;
            document.getElementById('geography-count').textContent = viewCounts['geography'] || 0;
            document.getElementById('timeline-count').textContent = viewCounts['timeline'] || 0;
        }
        
        function updateEventsView() {
            const container = document.getElementById('events-container');
            const events = analyticsData.events.slice(-50).reverse(); // Last 50 events
            
            if (events.length === 0) {
                container.innerHTML = '<div class="no-data">No events recorded yet.</div>';
                return;
            }
            
            container.innerHTML = events.map(event => `
                <div class="event-item">
                    <span class="event-timestamp">${formatTimestamp(event.timestamp)}</span>
                    <span class="event-type">${event.eventType}</span>
                    ${event.eventType === 'intent_signal' ? 
                        `<span class="intent-signal">${event.eventData.intentType}</span>` : ''}
                    ${event.eventType === 'friction_detected' ? 
                        `<span class="friction-signal">${event.eventData.frictionType}</span>` : ''}
                    <div class="event-details">${formatEventDetails(event)}</div>
                </div>
            `).join('');
        }
        
        function updateSessionsView() {
            const container = document.getElementById('sessions-container');
            const sessions = Object.values(analyticsData.sessions)
                .sort((a, b) => new Date(b.startTime) - new Date(a.startTime));
            
            if (sessions.length === 0) {
                container.innerHTML = '<div class="no-data">No sessions recorded yet.</div>';
                return;
            }
            
            container.innerHTML = sessions.map(session => `
                <div class="session-card">
                    <div class="session-header">
                        <span class="session-id">${session.sessionId}</span>
                        <span class="session-duration">${formatDuration(new Date(session.endTime) - new Date(session.startTime))}</span>
                    </div>
                    <div class="session-stats">
                        <div class="session-stat">
                            <span class="session-stat-value">${session.events.length}</span>
                            <span class="session-stat-label">Events</span>
                        </div>
                        <div class="session-stat">
                            <span class="session-stat-value">${session.views.size}</span>
                            <span class="session-stat-label">Views</span>
                        </div>
                        <div class="session-stat">
                            <span class="session-stat-value">${session.intents}</span>
                            <span class="session-stat-label">Intents</span>
                        </div>
                        <div class="session-stat">
                            <span class="session-stat-value">${session.friction}</span>
                            <span class="session-stat-label">Friction</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function updateIntentsView() {
            const container = document.getElementById('intents-container');
            const intents = analyticsData.intents.slice(-20).reverse();
            
            if (intents.length === 0) {
                container.innerHTML = '<div class="no-data">No intent signals detected yet.</div>';
                return;
            }
            
            container.innerHTML = intents.map(intent => `
                <div class="event-item">
                    <span class="event-timestamp">${formatTimestamp(intent.timestamp)}</span>
                    <span class="intent-signal">${intent.eventData.intentType}</span>
                    <div class="event-details">
                        Confidence: ${(intent.eventData.confidence * 100).toFixed(0)}%
                        ${intent.eventData.evidence ? ` | ${JSON.stringify(intent.eventData.evidence)}` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function updateFrictionView() {
            const container = document.getElementById('friction-container');
            const friction = analyticsData.friction.slice(-20).reverse();
            
            if (friction.length === 0) {
                container.innerHTML = '<div class="no-data">No friction points detected yet.</div>';
                return;
            }
            
            container.innerHTML = friction.map(f => `
                <div class="event-item">
                    <span class="event-timestamp">${formatTimestamp(f.timestamp)}</span>
                    <span class="friction-signal">${f.eventData.frictionType}</span>
                    <div class="event-details">
                        Severity: ${f.eventData.severity} | View: ${f.currentView}
                        ${f.eventData.dwellTime ? ` | Dwell: ${formatDuration(f.eventData.dwellTime)}` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        function updateVisualizationsView() {
            if (!window.behavioralVisualizer) return;
            
            const events = analyticsData.events;
            
            // Debug: Log the data we're working with
            console.log('üìä Visualizations: Processing', events.length, 'events');
            
            // Clear previous visualizations
            document.getElementById('journey-flow-container').innerHTML = '';
            document.getElementById('intent-timeline-container').innerHTML = '';
            document.getElementById('heatmap-container').innerHTML = '<div class="no-data">Heatmap visualization shows click patterns across the interface</div>';
            
            if (events.length === 0) {
                document.getElementById('journey-flow-container').innerHTML = '<div class="no-data">No user journey data available yet.</div>';
                document.getElementById('intent-timeline-container').innerHTML = '<div class="no-data">No intent data available yet.</div>';
                return;
            }
            
            // Show basic stats while visualizations load
            document.getElementById('journey-flow-container').innerHTML = `
                <div style="color: #ccc; padding: 20px; text-align: center;">
                    Processing ${events.length} events for journey visualization...
                </div>
            `;
            
            // Create journey flow visualization
            try {
                console.log('üìä Creating journey flow...');
                window.behavioralVisualizer.createJourneyFlow('journey-flow-container', events);
            } catch (error) {
                console.error('Error creating journey flow:', error);
                document.getElementById('journey-flow-container').innerHTML = `
                    <div class="no-data">
                        Error loading journey visualization<br>
                        <small style="color: #666;">${error.message}</small><br>
                        <small style="color: #888;">Events available: ${events.length}</small>
                    </div>
                `;
            }
            
            // Create intent timeline
            try {
                console.log('üìä Creating intent timeline...');
                window.behavioralVisualizer.createIntentTimeline('intent-timeline-container', events);
            } catch (error) {
                console.error('Error creating intent timeline:', error);
                document.getElementById('intent-timeline-container').innerHTML = `
                    <div class="no-data">
                        Error loading intent timeline<br>
                        <small style="color: #666;">${error.message}</small>
                    </div>
                `;
            }
            
            // Enhanced heatmap placeholder with actual data
            const clickEvents = events.filter(e => e.eventType === 'interaction' && e.eventData.action === 'click');
            const intentEvents = events.filter(e => e.eventType === 'intent_signal');
            
            document.getElementById('heatmap-container').innerHTML = `
                <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #888;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üéØ</div>
                    <div style="font-size: 18px; margin-bottom: 10px;">Interaction Analysis</div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 24px; color: #0066cc;">${clickEvents.length}</div>
                            <div style="font-size: 12px;">Click Events</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; color: #00cc66;">${intentEvents.length}</div>
                            <div style="font-size: 12px;">Intent Signals</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; color: #cc6600;">${new Set(events.map(e => e.sessionId)).size}</div>
                            <div style="font-size: 12px;">Unique Sessions</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function updateDomainInsightsView() {
            if (!window.behavioralVisualizer) return;
            
            const events = analyticsData.events;
            
            if (events.length === 0) {
                document.getElementById('domain-analysis-container').innerHTML = '<div class="no-data">No behavioral data available for domain analysis.</div>';
                document.getElementById('user-segments-container').innerHTML = '<div class="no-data">No user segment data available.</div>';
                document.getElementById('product-opportunities-container').innerHTML = '<div class="no-data">No product opportunities identified yet.</div>';
                return;
            }
            
            try {
                // Generate domain insights
                const insights = window.behavioralVisualizer.generateDomainInsights(events);
                
                // Update domain analysis
                document.getElementById('domain-analysis-container').innerHTML = 
                    DomainInsightsFormatter.formatAmmoniaInsights(insights.ammoniaMarketAnalysis);
                
                // Update user segments
                document.getElementById('user-segments-container').innerHTML = 
                    DomainInsightsFormatter.formatUserSegments(insights.userSegmentProfiles);
                
                // Update product opportunities
                document.getElementById('product-opportunities-container').innerHTML = 
                    DomainInsightsFormatter.formatProductOpportunities(insights.productOpportunities);
                    
            } catch (error) {
                console.error('Error generating domain insights:', error);
                document.getElementById('domain-analysis-container').innerHTML = '<div class="no-data">Error generating domain insights</div>';
                document.getElementById('user-segments-container').innerHTML = '<div class="no-data">Error analyzing user segments</div>';
                document.getElementById('product-opportunities-container').innerHTML = '<div class="no-data">Error identifying opportunities</div>';
            }
        }
        
        // Utility functions
        function formatTimestamp(timestamp) {
            return new Date(timestamp).toLocaleTimeString();
        }
        
        function formatDuration(ms) {
            const seconds = Math.floor(ms / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            
            if (hours > 0) return `${hours}h ${minutes % 60}m`;
            if (minutes > 0) return `${minutes}m ${seconds % 60}s`;
            return `${seconds}s`;
        }
        
        function formatEventDetails(event) {
            switch (event.eventType) {
                case 'interaction':
                    return `${event.eventData.action} on ${event.eventData.target?.element || 'unknown'} | View: ${event.currentView}`;
                case 'page_load':
                    return `Page loaded: ${event.currentView} | Load time: ${event.eventData.loadTime?.toFixed(0)}ms`;
                case 'dwell_pattern':
                    return `Dwell time: ${formatDuration(event.eventData.dwellDuration)} | View: ${event.currentView}`;
                default:
                    return `${event.currentView} | ${JSON.stringify(event.eventData).substring(0, 100)}`;
            }
        }
        
        // View controls
        function showView(viewName) {
            // Update button states
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Hide all views
            document.querySelectorAll('[id$="-view"]').forEach(view => {
                view.style.display = 'none';
            });
            
            // Show selected view
            document.getElementById(viewName + '-view').style.display = 'block';
            currentView = viewName;
            
            updateDashboard();
        }
        
        function refreshData() {
            loadAnalyticsData();
            updateDashboard();
            
            // Visual feedback
            const btn = event.target;
            btn.textContent = '‚úì Refreshed';
            setTimeout(() => {
                btn.textContent = 'üîÑ Refresh';
            }, 1000);
        }
        
        function clearData() {
            if (confirm('Are you sure you want to clear all analytics data? This cannot be undone.')) {
                localStorage.removeItem('pd_events');
                analyticsData = {
                    events: [],
                    sessions: {},
                    intents: [],
                    friction: []
                };
                updateDashboard();
            }
        }
    </script>
</body>
</html> 