<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gulf Coast Ammonia Plant Story - Maritime Intelligence</title>
    <link rel="stylesheet" href="../../styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="../../scripts/story-renderer.js"></script>
</head>

<div id="app">
    <!-- Content will be rendered here by JavaScript -->
    <div class="loading-state">
        <div class="loading-spinner">‚óè</div>
        <div class="loading-text">Loading maritime intelligence...</div>
    </div>
</div>

<script>
// YAML Data Loader and Renderer
async function loadStoryData() {
    try {
        // Load the YAML data
        const response = await fetch('../../data/stories/ammonia-plant.yaml');
        const yamlText = await response.text();
        const storyData = jsyaml.load(yamlText);
        
        // Override active view for story page
        storyData.navigation.active_view = "story";
        
        // Initialize renderer
        const renderer = new StoryRenderer(storyData);
        
        // Render the page
        const renderedContent = renderer.render();
        
        // Replace loading state with rendered content
        document.getElementById('app').innerHTML = renderedContent;
        
        // Initialize analytics tracking
        initializeAnalytics(storyData);
        
        console.log('‚úÖ Story loaded from YAML data successfully');
        console.log('üìä Semantic tags enabled:', storyData.semantic_tags);
        
    } catch (error) {
        console.error('‚ùå Error loading story data:', error);
        document.getElementById('app').innerHTML = `
            <div class="error-state">
                <h2>Error Loading Story</h2>
                <p>Could not load ammonia plant story data.</p>
                <button onclick="window.location.reload()">Retry</button>
            </div>
        `;
    }
}

// Analytics Initialization
function initializeAnalytics(storyData) {
    // Track story view
    console.log('üìà Analytics: Story viewed -', storyData.story_meta.story_id);
    
    // Track semantic concepts available for measurement
    const concepts = storyData.semantic_tags.content_concepts;
    console.log('üè∑Ô∏è Content concepts available for tracking:', concepts);
    
    // Track user journey markers
    const journeyMarkers = storyData.semantic_tags.user_journey_markers;
    console.log('üéØ Journey markers for comprehension tracking:', journeyMarkers);
    
    // Initialize click tracking for all semantic elements
    setTimeout(() => {
        document.querySelectorAll('[data-concept]').forEach(element => {
            const concept = element.getAttribute('data-concept');
            element.addEventListener('click', () => {
                console.log('üéØ Content Analytics: Concept engaged -', concept);
                // Real implementation would send to analytics service:
                // analytics.track('concept_engagement', { concept, story_id: storyData.story_meta.story_id });
            });
        });
        
        // Track semantic class interactions
        document.querySelectorAll('[class*="semantic-"]').forEach(element => {
            const semanticClasses = Array.from(element.classList)
                .filter(cls => cls.startsWith('semantic-'))
                .map(cls => cls.replace('semantic-', ''));
            
            element.addEventListener('click', () => {
                console.log('üè∑Ô∏è Semantic Analytics: Tags engaged -', semanticClasses);
            });
        });
    }, 100);
}

// Load story when page loads
document.addEventListener('DOMContentLoaded', loadStoryData);
</script>

<style>
.loading-state, .error-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    font-family: 'SF Pro Text', -apple-system, BlinkMacSystemFont, sans-serif;
}

.loading-spinner {
    font-size: 2rem;
    animation: pulse 1.5s ease-in-out infinite;
    color: #0066cc;
}

.loading-text {
    margin-top: 1rem;
    color: #666;
    font-size: 0.9rem;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

.error-state button {
    margin-top: 1rem;
    padding: 0.5rem 1rem;
    background: #0066cc;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

/* Semantic CSS Classes for Analytics & Visual Patterns */
.semantic-ammonia_pricing { border-left: 3px solid #ff6b6b; }
.semantic-market_decline { background-color: rgba(255, 107, 107, 0.1); }
.semantic-vessel_operation { border-left: 3px solid #4ecdc4; }
.semantic-competitive_dynamics { border-left: 3px solid #45b7d1; }
.semantic-route_optimization { background-color: rgba(76, 175, 80, 0.1); }
.semantic-operational_planning { background-color: rgba(255, 193, 7, 0.1); }

/* Enable hover effects for semantic elements */
[data-concept]:hover {
    background-color: rgba(0, 102, 204, 0.05);
    cursor: pointer;
}

[class*="semantic-"]:hover {
    transition: all 0.2s ease;
    transform: translateX(2px);
}
</style>

</html> 